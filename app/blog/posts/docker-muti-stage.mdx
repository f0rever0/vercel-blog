---
title: "multi-stageë¥¼ í™œìš©í•˜ì—¬ docker build size ì¤„ì´ê¸°"
publishedAt: "2024-03-05"
summary: "multi-stageë¥¼ í™œìš©í•˜ì—¬ docker build size ì¤„ì´ê¸°"
---

## 1. ë°°ê²½

í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œ í´ë”ë¥¼ ë¹Œë“œí•œ docker imageë¥¼ containerì— ë„ìš°ëŠ”ë°, dockerë¥¼ ë¹Œë“œí• ë•Œ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë ¤ì„œ ë©€í‹° ìŠ¤í…Œì´ì§€ë¥¼ ì ìš©í•´ë³´ì•˜ë‹¤!

## 2. ë„ì…

### ë©€í‹°ìŠ¤í…Œì´ì§€(multi-stage)ëŠ” ë¬´ì—‡ì¸ê°€

![ë©€í‹°ìŠ¤í…Œì´ì§€ ì„¤ëª…](https://github.com/f0rever0/f0rever0/assets/62867581/d1184f47-90a8-47b8-ab18-ec39b5513bc2)

dockerëŠ” ê° stageì—ì„œ í•„ìš”í•œ íŒŒì¼ë§Œ ê°€ì ¸ì™€ì„œ ê°€ì¥ ë§ˆì§€ë§‰ì— ì‹¤í–‰ëœ stageë¡œ ìµœì¢… ì´ë¯¸ì§€ë¥¼ êµ¬ì„±í•œë‹¤.

ì´ëŸ¬í•œ íŠ¹ì„±ì„ í™œìš©í•´ build stage ì™€ production stage ì»¨í…Œì´ë„ˆ ì‘ì—… ë‹¨ìœ„ë¥¼ ë¶„ë¦¬í•œë‹¤.

production stageì—ì„œëŠ” build stageì—ì„œ ì‚°ì¶œëœ build ê²°ê³¼ë¬¼ì„ ê°€ì ¸ì˜¨ë‹¤. ë¹Œë“œ ìºì‹œë¥¼ í™œìš©í•´ ì¤‘ë³µëœ ì‘ì—…ì„ í”¼í•˜ê³ , ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ”ë° ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë¹Œë“œ íŒŒì¼ì´ ìµœì¢… ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•Šì•„ ë¹Œë“œ í¬ê¸°ê°€ ì¤„ì–´ë“ ë‹¤.

### Dockerfile ì½”ë“œ ì‘ì„±í•˜ê¸°

```
// Build Stage
FROM node:18.18.0-alpine AS build
WORKDIR /usr/src/app
COPY package.json yarn.lock ./
RUN yarn install
COPY . .
RUN yarn build:$env

// Production Stage
FROM node:18.18.0-alpine
WORKDIR /usr/src/app
COPY --from=build /usr/src/app/.output ./.output
COPY --from=build /usr/src/app/package.json ./package.json
CMD ["node", ".output/server/index.mjs"]
```

## 3. ê²°ê³¼

![ë©€í‹°ìŠ¤í…Œì´ì§€ ì ìš©í•œ build í¬ê¸° ë³€í™”](https://github.com/f0rever0/f0rever0/assets/62867581/a5d94b43-5e80-404c-820f-c48270200323)

â†’ multi-stage ë¥¼ ì ìš©í–ˆì„ë•Œ ìš©ëŸ‰ì´ 2.46GB ì—ì„œ **184.38MB** ë¡œ ìš©ëŸ‰ ê°ì†Œ

ğŸ™‡â€â™‚ï¸ ì°¸ê³ ë¬¸í—Œ

[Dockerfile - Multi-stage build(ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ)](https://kimjingo.tistory.com/63)
