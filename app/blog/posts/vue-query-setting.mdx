---
title: "Vueì—ì„œ TanStack Query ì„¤ì • ë° ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬í•˜ê¸°"
publishedAt: "2025-01-31"
summary: "Vue í”„ë¡œì íŠ¸ì—ì„œ TanStack Queryë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ê³¼ useQueryì˜ ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•"
---

## 1. ë°°ê²½

í”„ë¡œì íŠ¸ì—ì„œ api í˜¸ì¶œì— ëŒ€í•œ ì—ëŸ¬ ë° ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ TanStack Queryë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. vueì—ì„œ TanStackì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ì„¸íŒ…ê³¼ useQueryì— ëŒ€í•œ ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ ê³¼ì •ì— ëŒ€í•´ ì†Œê°œí•©ë‹ˆë‹¤.

## 2. ë„ì…

#### ì„¤ì¹˜

ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¡œ `tanstack/vue-query`ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
npm i @tanstack/vue-query

pnpm add @tanstack/vue-query

yarn add @tanstack/vue-query
```

### ì´ˆê¸° ì„¸íŒ…

`vue-query.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  VueQueryPluginë¥¼ í™œìš©í•˜ì—¬ ì´ˆê¸° ì„¸íŒ…ì„ ì§„í–‰í•©ë‹ˆë‹¤.

```ts
import { VueQueryPlugin } from "@tanstack/vue-query";

vueApp.use(VueQueryPlugin);
```

### ê¸°ë³¸ ì˜µì…˜

ì´ë•Œ `vueApp.use(VueQueryPlugin, options);` ë¡œ QueryClientì—ì„œ ëª¨ë“  useQuery ë˜ëŠ” useMutationì— ê¸°ë³¸ ì˜µì…˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
import type {
  DehydratedState,
  VueQueryPluginOptions,
} from "@tanstack/vue-query";
import {
  VueQueryPlugin,
  QueryClient,
  hydrate,
  dehydrate,
} from "@tanstack/vue-query";
import { defineNuxtPlugin, useState } from "#imports";

export default defineNuxtPlugin(({ vueApp, hooks }) => {
  const vueQueryState = useState<DehydratedState | null>("vue-query");

  // Modify your Vue Query global settings here
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { staleTime: 0, retry: 1, refetchOnMount: true },
    },
  });
  const options: VueQueryPluginOptions = { queryClient };

  vueApp.use(VueQueryPlugin, options);

  if (process.server) {
    hooks.hook("app:rendered", () => {
      vueQueryState.value = dehydrate(queryClient);
    });
  }

  if (process.client) {
    hydrate(queryClient, vueQueryState.value);
  }
});
```

í”„ë¡œì íŠ¸ì—ì„œëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ê°€ ë³€ê²½ë˜ë¯€ë¡œ í˜ì´ì§€ ì¬ì ‘ì†ì‹œ apië¥¼ refetch í•˜ë„ë¡ staleTimeì„ 0ì´ˆë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ ì‹¤ì‹œê°„ì„± ë°ì´í„°ê°€ ì•„ë‹ ê²½ìš° staleTimeì„ ì—°ì¥í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¸ì¦ ê´€ë ¨ apiê°€ ìˆê¸°ì— ì—ëŸ¬ ë°œìƒ ì¦‰ì‹œ ë‹¤ë¥¸ ì•¡ì…˜ì„ ì·¨í•´ì•¼í•¨ìœ¼ë¡œ retry íšŸìˆ˜ë¥¼ ë‚®ê²Œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

### ì „ì—­ ì½œë°± í•¨ìˆ˜ ì‚¬ìš©

TanStack v5ì—ì„œëŠ” onSuccess, onError, onSettledê°€ deprecated ë˜ì—ˆìŠµë‹ˆë‹¤.

onErrorë¥¼ useQueryì—ì„œ í˜¸ì¶œí•˜ëŠ” ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

useQueryì˜ onError ì½œë°±ì€ ëª¨ë“  Observerì— ëŒ€í•´ í˜¸ì¶œë©ë‹ˆë‹¤. ë§Œì•½ ì•„ë˜ ì˜ˆì‹œì˜ `useTodos()` ë¥¼ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆì„ë•Œ useTodo í˜¸ì¶œì‹œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ useTodosë¥¼ ì‚¬ìš©í•˜ëŠ” íšŸìˆ˜ë§Œí¼ ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì…ë‹ˆë‹¤.
ì¦‰, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ useTodosë¥¼ ë‘ ë²ˆ í˜¸ì¶œí•˜ë©´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ í•œ ë²ˆë§Œ ì‹¤íŒ¨í•˜ë”ë¼ë„ ë‘ ë²ˆì˜ ì—ëŸ¬ í† ìŠ¤íŠ¸ê°€ ëœ¨ê²Œ ë©ë‹ˆë‹¤.

í•´ë‹¹ ë°ì´í„° ìš”ì²­ì´ ì‹¤íŒ¨í•œê±´ í•œ ë²ˆì¼ ë¿ì¸ë°, ì‚¬ìš©í•˜ëŠ” í˜¸ì¶œíšŸìˆ˜ ë§Œí¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì€ reactì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ useEffectë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë³„ë°˜ ì°¨ì´ê°€ ì—†ëŠ” ì…ˆì…ë‹ˆë‹¤.

ë”°ë¼ì„œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ê° useQueryì—ì„œ í•˜ì§€ ì•Šê³ , `QueryClient`ë¡œ ì „ì—­ ì½œë°±í•¨ìˆ˜ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œí•©ë‹ˆë‹¤.

```js
const useTodos = () =>
  useQuery({
    queryKey: ["todos"],
    queryFn: fetchTodos,
    // âš ï¸ looks good, but is maybe _not_ what you want
    onError: (error) => toast.error(`Something went wrong: ${error.message}`),
  });
```

```ts
import type {
  DehydratedState,
  VueQueryPluginOptions,
} from "@tanstack/vue-query";
import {
  VueQueryPlugin,
  QueryClient,
  QueryCache,
  hydrate,
  dehydrate,
} from "@tanstack/vue-query";
import { defineNuxtPlugin, useState } from "#imports";
import { handleApiError } from "@utils/error";

export default defineNuxtPlugin(({ vueApp, hooks }) => {
  const vueQueryState = useState<DehydratedState | null>("vue-query");

  const queryClient = new QueryClient({
    queryCache: new QueryCache({
      onError: (error) => {
        handleApiError();
      },
    }),
    defaultOptions: {
      queries: {
        retry: 0,
        staleTime: 0,
      },
    },
  });
  const options: VueQueryPluginOptions = { queryClient };

  vueApp.use(VueQueryPlugin, options);

  if (process.server) {
    hooks.hook("app:rendered", () => {
      vueQueryState.value = dehydrate(queryClient);
    });
  }

  if (process.client) {
    hydrate(queryClient, vueQueryState.value);
  }
});
```

`queryCache`ì—ì„œ ì—ëŸ¬ë¥¼ í†µí•© ê´€ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

onError() ì½œë°± í•¨ìˆ˜ëŠ” Queryë‹¹ í•œ ë²ˆë§Œ í˜¸ì¶œë©ë‹ˆë‹¤. useQuery í˜¸ì¶œì‹œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì „ì—­ì—ì„œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ë¶ˆí•„ìš”í•˜ê²Œ ë°˜ë³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  useQueryë¥¼ í˜¸ì¶œí•œ ì»´í¬ë„ŒíŠ¸ ë°”ê¹¥ì— ì¡´ì¬í•˜ë¯€ë¡œ í´ë¡œì € ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ğŸ’¡ í´ë¡œì €

> ì–´ë–¤ í•¨ìˆ˜ Aì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ aë¥¼ ì°¸ì¡°í•˜ëŠ” ë‚´ë¶€í•¨ìˆ˜ Bë¥¼ ì™¸ë¶€ë¡œ ì „ë‹¬(return, ì½œë°±)í•  ê²½ìš° Aì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ ì´í›„ì—ë„ ë³€ìˆ˜ aê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” í˜„ìƒ

**useQuery ë‚´ë¶€ì—ì„œ í´ë¡œì € ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„±**

onError ì½œë°±ì„ useQuery ë‚´ì—ì„œ ì„ ì–¸í•˜ë©´, í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœ(state)ë‚˜ ë³€ìˆ˜(variable)ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ê²½ìš°, í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ì–´ë„ í´ë¡œì €ë¥¼ í†µí•´ ì°¸ì¡°ë˜ë˜ ê°’ì´ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì—ëŸ¬ í•¨ìˆ˜ ë¶„ë¦¬

`handleApiError()` ì „ì—­ ì—ëŸ¬ ë¡œì§ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

useQueryì—ì„œ `isError` ì˜µì…˜ë¥¼ í™œìš©í•´ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ë„ ìˆì§€ë§Œ, useQueryë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì´ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤ë©´ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ì—ëŸ¬ ìƒíƒœì— ë”°ë¥¸ ì•¡ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ê³µí†µ í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³  ì´ë¥¼ onError ì½œë°± í•¨ìˆ˜ì—ì„œ ì‹¤í–‰í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

```ts
const handleApiError = (errorCode: string) => {
  switch (errorCode) {
    case E0001:
      navigateTo("/login", {
        replace: true,
      });
      addToast({
        text: "ì˜ëª»ëœ ë¡œê·¸ì¸ ì •ë³´ì…ë‹ˆë‹¤.",
        type: "forbid",
        timeout: 3000,
      });
      break;
    case E0002:
      navigateTo("/login", {
        replace: true,
      });
      addToast({
        text: "ìœ ì € í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
        type: "forbid",
        timeout: 3000,
      });
      break;
    ...
  }
};
```

## 3. ê²°ê³¼

TanStackì„ ì‚¬ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì—ëŸ¬ ë°œìƒê³¼ ì¤‘ë³µëœ ì—ëŸ¬ ì²˜ë¦¬ ì½”ë“œê°€ ì œê±°ë˜ì–´ ìœ ì§€ë³´ìˆ˜ì„±ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ™‡â€â™‚ï¸ ì°¸ê³ ë¬¸í—Œ

[Breaking React Query's API on purpose
](https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose)

[[ë²ˆì—­] React Query APIì˜ ì˜ë„ëœ ì¤‘ë‹¨](https://velog.io/@cnsrn1874/breaking-react-querys-api-on-purpose)

[React Query Error Handling](https://tkdodo.eu/blog/react-query-error-handling#the-global-callbacks)
